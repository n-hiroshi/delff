![repo version](https://img.shields.io/badge/Version-v.%201.0-green)
![python version](https://img.shields.io/badge/python-v.3.8-blue)
![License: CC BY-NC 4.0](https://img.shields.io/badge/License-CC_BY--NC_4.0-orange.svg)]

# delff
End-to-End Differentiable Force Field Generator with Crystal Structure Differentiation and Matching

For more information, please read : 
* ChemRxiv(https://chemrxiv.org/engage/chemrxiv/article-details/63e098c4805bad91da1bbf37)

## Getting Started

### Prerequisites

The following libraries are required:

*[Python 3](https://www.python.org/download/releases/3.8/) version 3.8.16

*[JAX] version 0.4.2

*[JAXOPT] version 0.6

*[SciPy] version 1.10.1

*[NumPy](https://scipy.org/install.html) version 1.23.5

*[pandas](https://pandas.pydata.org) version 2.0.1

*[LAMMPS](https://lammps.org) release 27 May 2021

*[Gaussian](https://gaussian.com) version 16.B01

The operability of the versios at the side of the libary names were confirmed. 

### Installation

Installation is completed by copying this whole library to your local computer.

### Test

The following commands let you comfirm the successfull installation
with a sample dataset in the same directory as _alltests.sh_.
All of the usecases are included in the test programs.

```
cd [installation directory]/delff/test/
python main_lattice_[molecule name].py [ID] [FDM/SDM]
```
[molecule_name] = acanil/antcen/benzac/biphen/bpheno/naphol/pencen/tphben

[ID] = any numbers from 0 to 999 indicating the folder name
in which omputed results will be stored.

[FDM/SDM] = force field optimization methods discussed in the paper.


### Generate a Force Field of an Original Molecule

1. Create a directory with a suitable name in the `./test/data/` directory. For this example, we'll use the name "mol1".
1. Prepare the following files in the `./test/data/mol1/` directory.:

   1. mol1.gjf:
      The optmized single molecule structure in Gaussian gjf file format. The comment line must follow the special syntax: `[molecule name] nmol_natoms 1_[natoms]`,
      where [moleculename] is the molecule name literaly[natom] is a number of atoms in the molecule.

   1. mol1.data and mol1.in.settings:
    LAMMPS system.data and system.in.settings file for the single molecule.
    Typically, Antechamber[1] and Moltemplate[2] are useful to make LAMMPS system.data and system.in.settings files.(The redundant and unused parameters in system.data and system.in.settings must be deleted in case the two tools used.)

   1. mol1_lat.gjf:
    The cystal structrure file in Gaussian gjf file format.
    with three`Tv` lines defining the lattice vectors.
    The comment line must follow the special syntax: `[molecule name] nmol_natoms [nmol]_[natoms]`,
    where [nmol] is a number of molecule in the unit cell,and [natom] is a number of atoms in the molecule.

   - Refer the eight examples in './test/data/acanil/', './test/data/antcen/', and so on for making sure the file formats.

1. Copy `./test/main_lattice_acanil.py` as `./test/main_lattice_mol1.py`.
1. Edit `./test/main_lattice_mol1.py` as described below.
1. Run `python main_lattice_mol1.py 1 SDM`.
  Here, "1" indicates that the result will be saved in a directory named "res001". 
  Any three-digit number is acceptable. 
  "SDM" represents a method explained in a paper,
  and can be switched to another method, "FDM", also described in the paper.


References:
[1]	Wang, J.; Wang, W.; Kollman, P. A.; Case, D. A. Automatic Atom Type and Bond Type Perception in Molecular Mechanical Calculations. J. Mol. Graph. Model. 2006, 25 (2), 247â€“260.
[2]	Jewett, A. I.; Stelter, D.; Lambert, J.; Saladi, S. M.; Roscioni, O. M.; Ricci, M.; Autin, L.; Maritan, M.; Bashusqeh, S. M.; Keyes, T.; Dame, R. T.; Shea, J.-E.; Jensen, G. J.; Goodsell, D. S. Moltemplate: A Tool for Coarse-Grained Modeling of Complex Biological Matter and Soft Condensed Matter Physics. J. Mol. Biol. 2021, 433 (11), 166841.



### Further information

The documants of 'Read the docs'(https://docs.readthedocs.io/en/stable/) format is generated by the command:

```
cd [installation directory]/delff
./autosphinx.sh
```


## Authors

* Hiroshi Nakano
* Shinnosuke Hattori 
* Hajime Kobayashi 
* Takumi Araki 
* Masakazu Ukita 
* Toshio Nishi 
* Yoshihiro Kudo 

## License

<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
